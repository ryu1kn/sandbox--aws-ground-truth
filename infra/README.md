# Infra

Originally created with `cdk init app --language typescript`.

The `cdk.json` file tells the CDK Toolkit how to execute your infra app.

## Prerequisites

### Install tools & dependencies

* Node.js v16.10+ is installed: `brew install node`
* Node.js package manager, Yarn: https://yarnpkg.com/getting-started/install
* Dependencies installed: `yarn install`

### Setup resources for AWS CDK to manage your AWS resources

Create resources for AWS CDK to store assets (replace `<xyz>` to appropriate values)

```sh
AWS_PROFILE=<your-profile> yarn cdk bootstrap aws://<account-id>/<region>
```

You can get AWS account ID for your profile by running below

```sh
AWS_PROFILE=<your-profile> aws sts get-caller-identity --query Account --output text
```

## Deploy

### Resources created on AWS console and not coded in this repository

The following resources are created manually on AWS Console; so to test this repository
yourself, you also need to create it upfront.

* AWS Cognito User Pool
* AWS Ground Truth Private Worker Team: `manually-created-for-test`

### Use CDK to deploy your AWS resources

Other than the resources listed above, all should be covered by CDK.
You can deploy the resources with:

```sh
AWS_PROFILE=<your-profile> yarn cdk deploy
```

This will deploy / redeploy your Stack to your AWS Account.

After the deployment you will see the ARN of your CloudFormation stack.
You can inspect the resources created in the stack.

## Synthesize Cloudformation Template

To see the Cloudformation template generated by the CDK, run:

```sh
yarn cdk synth
```

then check the output file in the "cdk.out" directory.

## Other useful commands

* `cdk ls`          list all stacks in the app
* `cdk deploy`      deploy this stack to your default AWS account/region
* `cdk diff`        compare deployed stack with current state
* `cdk docs`        open CDK documentation

## References

* [AWS Cloud Development Kit (AWS CDK) v2 - Developer Guide](https://docs.aws.amazon.com/cdk/v2/guide/home.html)
* [AWS CDK v2 API Reference](https://docs.aws.amazon.com/cdk/api/v2/docs/aws-construct-library.html)
* [CDK TypeScript Example](https://github.com/aws-samples/aws-cdk-examples/tree/0342729d5fb380064146a8bb38531fcc00ae6972/typescript)
* [Use Ground Truth to Label Text - AWS Developer Guide](https://docs.aws.amazon.com/sagemaker/latest/dg/sms-label-text.html)
* [Input Data - Supported Data Formats](https://docs.aws.amazon.com/sagemaker/latest/dg/sms-supported-data-formats.html)
